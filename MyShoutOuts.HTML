<html>

<body onload="start()">
	<style>
		#vid {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
		}

		#img {
			position: absolute;
			top: 15%;
			left: 30%;
			width: 40%;
		}
	</style>

	<script>



		async function getData() {
			url = "https://gql.twitch.tv/gql";
			query =
			{
				operationName: "VideoAccessToken_Clip",
				variables: {
					slug: clipId,
					platform: "web"
				},
				extensions: {
					persistedQuery: {
						version: 1,
						sha256Hash: "6fd3af2b22989506269b9ac02dd87eb4a6688392d67d94e41a6886f1e9f5c00f"
					}
				}
			}

			config = {
				method: "POST",
				headers: {
					"Content-Type": "text/plain;charset=UTF-8",
					"Client-ID": "kimne78kx3ncx6brgo4mv6wki5h1ko"
				},
				body: JSON.stringify(query)
			}
			response = await fetch(url, config)
			data = await response.json()
			return data
		}

		async function start() {

			params = new URLSearchParams(window.location.search)
			user = params.get("user")
			image = params.get("image")
			video = params.get("video")
			thumbnail_url = params.get("thumbnail_url")
			time = params.get("time")
			document.getElementById("img").src = image

			clipId = video.split("clip=")[1]

			data = await getData()


			clipSource = data.data.clip.videoQualities[0].sourceURL;
			clipSig = data.data.clip.playbackAccessToken.signature;
			clipToken = data.data.clip.playbackAccessToken.value

			v = document.getElementById("vid")
			v.src = clipSource + "?sig=" + clipSig + "&token=" + clipToken;
			v.play()
			document.getElementById("img").hidden = true
		}

		function end() {
			//if (closeWindowOnEnd) {
			//	window.close()
			//}
			document.getElementById("vid").hidden = true
		}
	</script>
	<img id="img">
	<video id="vid" width="100%" onended="end()"></video>
</body>

</html>
